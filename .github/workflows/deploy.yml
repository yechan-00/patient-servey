name: prototype 1 deploy to GitHub Pages

# 워크플로우 트리거 설정
on:
  push:
    branches: [main]
  workflow_dispatch:

# 최소 권한 설정
permissions:
  contents: read
  pages: write
  id-token: write

# 작업 정의
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install web1 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web1

      - name: Build web1
        run: CI=false npm run build
        working-directory: ./web1

      - name: Install web2 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web2

      - name: Build web2
        run: CI=false npm run build
        working-directory: ./web2

      - name: Install web3 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web3

      - name: Build web3
        run: CI=false npm run build
        working-directory: ./web3

      - name: Install web4 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web4

      - name: Build web4
        run: CI=false npm run build
        working-directory: ./web4

      - name: Install web5 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web5

      - name: Build web5
        run: CI=false npm run build
        working-directory: ./web5

      - name: Collate build outputs
        run: |
          mkdir -p dist

          echo "Copying web1 build output..."
          if [ -d "web1/build" ]; then
            cp -r web1/build dist/web1
          elif [ -d "web1/dist" ]; then
            cp -r web1/dist dist/web1
          else
            echo "Error: web1 build output directory not found"
            exit 1
          fi

          echo "Copying web2 build output..."
          if [ -d "web2/build" ]; then
            cp -r web2/build dist/web2
          elif [ -d "web2/dist" ]; then
            cp -r web2/dist dist/web2
          else
            echo "Error: web2 build output directory not found"
            exit 1
          fi

          echo "Copying web3 build output..."
          if [ -d "web3/build" ]; then
            cp -r web3/build dist/web3
          elif [ -d "web3/dist" ]; then
            cp -r web3/dist dist/web3
          else
            echo "Error: web3 build output directory not found"
            exit 1
          fi

          echo "Copying web4 build output..."
          if [ -d "web4/build" ]; then
            cp -r web4/build dist/web4
          elif [ -d "web4/dist" ]; then
            cp -r web4/dist dist/web4
          else
            echo "Error: web4 build output directory not found"
            exit 1
          fi

          echo "Copying web5 build output..."
          if [ -d "web5/build" ]; then
            cp -r web5/build dist/web5
          elif [ -d "web5/dist" ]; then
            cp -r web5/dist dist/web5
          else
            echo "Error: web5 build output directory not found"
            exit 1
          fi

          echo "Creating root index.html..."
          echo "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImtvIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgLz4KPHRpdGxlPuyVlCDsg53sobTsnpAg7LyA7Ja0IOyLnOyKpO2FnDwvdGl0bGU+CjxzdHlsZT4KKnttYXJnaW46MDtwYWRkaW5nOjA7Ym94LXNpemluZzpib3JkZXItYm94fQpib2R5e2ZvbnQtZmFtaWx5Oi1hcHBsZS1zeXN0ZW0sQmxpbmtNYWNTeXN0ZW1Gb250LCJTZWdvZSBVSSIsIlJvYm90byIsIk94eWdlbiIsIlVidW50dSIsIkNhbnRhcmVsbCIsIkZpcmEgU2FucyIsIkRyb2lkIFNhbnMiLCJIZWx2ZXRpY2EgTmV1ZSIsc2Fucy1zZXJpZjtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxMzVkZWcsIzY2N2VlYSAwJSwjNzY0YmEyIDEwMCUpO21pbi1oZWlnaHQ6MTAwdmg7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6MjBweH0KLmNvbnRhaW5lcntiYWNrZ3JvdW5kOndoaXRlO2JvcmRlci1yYWRpdXM6MjBweDtib3gtc2hhZG93OjAgMjBweCA2MHB4IHJnYmEoMCwwLDAsMC4zKTtwYWRkaW5nOjQwcHg7bWF4LXdpZHRoOjgwMHB4O3dpZHRoOjEwMCV9Cmgxe2NvbG9yOiMzMzM7bWFyZ2luLWJvdHRvbToxMHB4O2ZvbnQtc2l6ZToycmVtO3RleHQtYWxpZ246Y2VudGVyfQouc3VidGl0bGV7Y29sb3I6IzY2NjttYXJnaW4tYm90dG9tOjQwcHg7Zm9udC1zaXplOjEuMXJlbTt0ZXh0LWFsaWduOmNlbnRlcn0KLmFwcHMtZ3JpZHtkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCgyLDFmcik7Z2FwOjIwcHg7bWFyZ2luLXRvcDozMHB4O21heC13aWR0aDo2MDBweDttYXJnaW4tbGVmdDphdXRvO21hcmdpbi1yaWdodDphdXRvfQouYXBwLWNhcmR7YmFja2dyb3VuZDojZjhmOWZhO2JvcmRlci1yYWRpdXM6MTJweDtwYWRkaW5nOjI1cHg7dGV4dC1hbGlnbjpjZW50ZXI7dHJhbnNpdGlvbjphbGwgMC4zcyBlYXNlO2N1cnNvcjpwb2ludGVyO2JvcmRlcjoycHggc29saWQgdHJhbnNwYXJlbnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Y29sb3I6aW5oZXJpdDtkaXNwbGF5OmJsb2NrfQouYXBwLWNhcmQ6aG92ZXJ7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoLTVweCk7Ym94LXNoYWRvdzowIDEwcHggMzBweCByZ2JhKDAsMCwwLDAuMik7Ym9yZGVyLWNvbG9yOiM2NjdlZWF9Ci5hcHAtaWNvbntmb250LXNpemU6M3JlbTttYXJnaW4tYm90dG9tOjE1cHh9Ci5hcHAtdGl0bGV7Zm9udC1zaXplOjEuMnJlbTtmb250LXdlaWdodDo2MDA7Y29sb3I6IzMzMzttYXJnaW4tYm90dG9tOjhweH0KLmFwcC1kZXNje2ZvbnQtc2l6ZTowLjlyZW07Y29sb3I6IzY2NjtsaW5lLWhlaWdodDoxLjR9CkBtZWRpYSAobWF4LXdpZHRoOjYwMHB4KXsuY29udGFpbmVye3BhZGRpbmc6MjBweH1oMXtmb250LXNpemU6MS41cmVtfS5hcHBzLWdyaWR7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcjttYXgtd2lkdGg6MTAwJX19Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CjxoMT7slZQg7IOd7KG07J6QIOy8gOyWtCDsi5zsiqTthZw8L2gxPgo8cCBjbGFzcz0ic3VidGl0bGUiPu2ZmOyekOyZgCDsnZjro4zsp4TsnYQg7JyE7ZWcIO2Gte2VqSDqtIDrpqwg7ZSM656r7Y+8PC9wPgo8ZGl2IGNsYXNzPSJhcHBzLWdyaWQiPgo8YSBocmVmPSIvcGF0aWVudC1zZXJ2ZXkvd2ViMS8iIGNsYXNzPSJhcHAtY2FyZCI+CjxkaXYgY2xhc3M9ImFwcC1pY29uIj7wn5OLPC9kaXY+CjxkaXYgY2xhc3M9ImFwcC10aXRsZSI+7IOd7KG07J6QIOyEpOusuDwvZGl2Pgo8ZGl2IGNsYXNzPSJhcHAtZGVzYyI+7JWUIOyDneyhtOyekOulvCDsnITtlZwg6rG06rCV6rSA66asIOyEpOusuDwvZGl2Pgo8L2E+CjxhIGhyZWY9Ii9wYXRpZW50LXNlcnZleS93ZWIzLyIgY2xhc3M9ImFwcC1jYXJkIj4KPGRpdiBjbGFzcz0iYXBwLWljb24iPvCfj6U8L2Rpdj4KPGRpdiBjbGFzcz0iYXBwLXRpdGxlIj7tmZjsnpAg7ISk66y4PC9kaXY+CjxkaXYgY2xhc3M9ImFwcC1kZXNjIj7slZQg7ZmY7J6Q7J2YIOyCrO2ajOyggSDsmpXqtawg7ISk66y4PC9kaXY+CjwvYT4KPGEgaHJlZj0iL3BhdGllbnQtc2VydmV5L3dlYjQvIiBjbGFzcz0iYXBwLWNhcmQiPgo8ZGl2IGNsYXNzPSJhcHAtaWNvbiI+8J+SrDwvZGl2Pgo8ZGl2IGNsYXNzPSJhcHAtdGl0bGUiPuy7pOuupOuLiO2LsDwvZGl2Pgo8ZGl2IGNsYXNzPSJhcHAtZGVzYyI+7ZmY7J6Q7JmAIOyDneyhtOyekCDsu6TrrqTri4jti7A8L2Rpdj4KPC9hPgo8YSBocmVmPSIvcGF0aWVudC1zZXJ2ZXkvd2ViNS8iIGNsYXNzPSJhcHAtY2FyZCI+CjxkaXYgY2xhc3M9ImFwcC1pY29uIj7wn5SQPC9kaXY+CjxkaXYgY2xhc3M9ImFwcC10aXRsZSI+66Gc6re47J24PC9kaXY+CjxkaXYgY2xhc3M9ImFwcC1kZXNjIj7thrXtlakg66Gc6re47J24IO2OmOydtOyngDwvZGl2Pgo8L2E+CjwvZGl2Pgo8L2Rpdj4KPC9ib2R5Pgo8L2h0bWw+Cg==" | base64 -d > dist/index.html

      - name: Upload artifact for GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
