name: prototype 1 deploy to GitHub Pages

# ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ì„¤ì •
on:
  push:
    branches: [main]
  workflow_dispatch:

# ìµœì†Œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ì‘ì—… ì •ì˜
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install web1 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web1

      - name: Build web1
        run: CI=false npm run build
        working-directory: ./web1

      - name: Install web2 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web2

      - name: Build web2
        run: CI=false npm run build
        working-directory: ./web2

      - name: Install web3 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web3

      - name: Build web3
        run: CI=false npm run build
        working-directory: ./web3

      - name: Install web4 dependencies
        run: npm install --legacy-peer-deps
        working-directory: ./web4

      - name: Build web4
        run: CI=false npm run build
        working-directory: ./web4

      - name: Collate build outputs
        run: |
          mkdir -p dist

          echo "Copying web1 build output..."
          if [ -d "web1/build" ]; then
            cp -r web1/build dist/web1
          elif [ -d "web1/dist" ]; then
            cp -r web1/dist dist/web1
          else
            echo "Error: web1 build output directory not found"
            exit 1
          fi

          echo "Copying web2 build output..."
          if [ -d "web2/build" ]; then
            cp -r web2/build dist/web2
          elif [ -d "web2/dist" ]; then
            cp -r web2/dist dist/web2
          else
            echo "Error: web2 build output directory not found"
            exit 1
          fi

          echo "Copying web3 build output..."
          if [ -d "web3/build" ]; then
            cp -r web3/build dist/web3
          elif [ -d "web3/dist" ]; then
            cp -r web3/dist dist/web3
          else
            echo "Error: web3 build output directory not found"
            exit 1
          fi

          echo "Copying web4 build output..."
          if [ -d "web4/build" ]; then
            cp -r web4/build dist/web4
          elif [ -d "web4/dist" ]; then
            cp -r web4/dist dist/web4
          else
            echo "Error: web4 build output directory not found"
            exit 1
          fi

          echo "Creating root index.html..."
          cat > dist/index.html << 'EOF'
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì•” ìƒì¡´ì ì¼€ì–´ ì‹œìŠ¤í…œ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
.container{background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);padding:40px;max-width:800px;width:100%}
h1{color:#333;margin-bottom:10px;font-size:2rem}
.subtitle{color:#666;margin-bottom:40px;font-size:1.1rem}
.apps-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:30px}
.app-card{background:#f8f9fa;border-radius:12px;padding:25px;text-align:center;transition:all 0.3s ease;cursor:pointer;border:2px solid transparent;text-decoration:none;color:inherit;display:block}
.app-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,0.2);border-color:#667eea}
.app-icon{font-size:3rem;margin-bottom:15px}
.app-title{font-size:1.2rem;font-weight:600;color:#333;margin-bottom:8px}
.app-desc{font-size:0.9rem;color:#666;line-height:1.4}
@media (max-width:600px){.container{padding:20px}h1{font-size:1.5rem}.apps-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
<h1>ì•” ìƒì¡´ì ì¼€ì–´ ì‹œìŠ¤í…œ</h1>
<p class="subtitle">í™˜ìì™€ ì˜ë£Œì§„ì„ ìœ„í•œ í†µí•© ê´€ë¦¬ í”Œë«í¼</p>
<div class="apps-grid">
<a href="/patient-servey/web1/" class="app-card">
<div class="app-icon">ğŸ“‹</div>
<div class="app-title">ìƒì¡´ì ì„¤ë¬¸</div>
<div class="app-desc">ì•” ìƒì¡´ìë¥¼ ìœ„í•œ ê±´ê°•ê´€ë¦¬ ì„¤ë¬¸</div>
</a>
<a href="/patient-servey/web2/" class="app-card">
<div class="app-icon">ğŸ“Š</div>
<div class="app-title">ëŒ€ì‹œë³´ë“œ</div>
<div class="app-desc">ì˜ë£Œì§„ìš© í™˜ì ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</div>
</a>
<a href="/patient-servey/web3/" class="app-card">
<div class="app-icon">ğŸ¥</div>
<div class="app-title">í™˜ì ì„¤ë¬¸</div>
<div class="app-desc">ì•” í™˜ìì˜ ì‚¬íšŒì  ìš•êµ¬ ì„¤ë¬¸</div>
</a>
<a href="/patient-servey/web4/" class="app-card">
<div class="app-icon">ğŸ’¬</div>
<div class="app-title">ì»¤ë®¤ë‹ˆí‹°</div>
<div class="app-desc">í™˜ìì™€ ìƒì¡´ì ì»¤ë®¤ë‹ˆí‹°</div>
</a>
<a href="/patient-servey/web5/" class="app-card">
<div class="app-icon">ğŸ”</div>
<div class="app-title">ë¡œê·¸ì¸</div>
<div class="app-desc">í†µí•© ë¡œê·¸ì¸ í˜ì´ì§€</div>
</a>
</div>
</div>
</body>
</html>
EOF

      - name: Upload artifact for GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
