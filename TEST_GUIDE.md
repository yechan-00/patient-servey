# 테스트 가이드

## 테스트 전 준비사항

1. **브라우저 개발자 도구 열기**

   - Chrome/Edge: `F12` 또는 `Cmd+Option+I` (Mac) / `Ctrl+Shift+I` (Windows)
   - Console 탭과 Application 탭 열어두기

2. **콘솔 로그 필터 설정**
   - Console 탭에서 필터를 "All levels"로 설정
   - 또는 `[Info]`, `[SurveyForm]`, `[savePatientMapped]` 등으로 검색

---

## 테스트 시나리오 1: 기본 스크리닝 페이지 저장 기능

### 목적

뒤로 가기로 돌아왔을 때 입력한 데이터가 유지되는지 확인

### 테스트 단계

1. **홈 페이지에서 설문 시작**

   - 홈 → "설문 시작" 버튼 클릭
   - 콘솔에 `[Info] 새 설문 시작` 로그 확인

2. **기본 스크리닝 페이지에서 데이터 입력**

   - 이름: `테스트홍길동`
   - 생년월일: `1990-01-01`
   - 성별: `남성` (또는 원하는 값)
   - 기타 필수 항목들 입력
   - **중요**: 입력 후 잠시 대기 (자동 저장 대기)

3. **다음 페이지로 이동**

   - 기본 스크리닝 페이지 제출 버튼 클릭
   - 설문 페이지로 이동

4. **뒤로 가기로 기본 스크리닝 페이지로 복귀**

   - 브라우저 뒤로 가기 버튼 클릭
   - 기본 스크리닝 페이지로 돌아옴

5. **데이터 확인**
   - ✅ **성공**: 입력했던 이름, 생년월일 등이 그대로 표시됨
   - ❌ **실패**: 입력 필드가 비어있음

### 확인해야 할 콘솔 로그

```
[Info] 뒤로 가기로 돌아옴 - 데이터 유지, localStorage 상태: {...}
[SurveyForm] 마운트 시 localStorage 로드 시도
[SurveyForm] localStorage에서 데이터 로드: {...}
[SurveyForm] 데이터 로드 완료
```

### 제공해야 할 정보 (실패 시)

1. **콘솔 로그 전체** (위 로그들 포함)
2. **localStorage 상태** (Application 탭 → Local Storage → `survey-draft` 키의 값)
3. **어느 단계에서 문제가 발생했는지** (예: "4번 단계에서 뒤로 가기 했을 때")

---

## 테스트 시나리오 2: 새 설문 시작 시 초기화 확인

### 목적

새 설문을 시작할 때 이전 데이터가 제대로 초기화되는지 확인

### 테스트 단계

1. **첫 번째 설문 시작**

   - 홈 → 설문 시작
   - 기본 스크리닝 페이지에서 일부 입력 (예: 이름 `홍길동`)
   - 설문 페이지로 이동

2. **홈으로 돌아가기**

   - 브라우저 뒤로 가기로 홈으로 이동
   - 또는 직접 홈 URL로 이동

3. **새 설문 시작**

   - 홈 → "설문 시작" 버튼 클릭

4. **초기화 확인**
   - ✅ **성공**: 기본 스크리닝 페이지가 완전히 비어있음
   - ❌ **실패**: 이전에 입력했던 데이터가 남아있음

### 확인해야 할 콘솔 로그

```
[Info] 새 설문 시작 - 초기화 시작
[Info] 새 설문 시작 - Survey form reset and previous patient data cleared
[SurveyForm] 마운트 시 localStorage 로드 시도
[SurveyForm] localStorage에 저장된 데이터 없음
```

### 제공해야 할 정보 (실패 시)

1. **콘솔 로그 전체**
2. **localStorage 상태** (`survey-draft` 키가 삭제되었는지 확인)
3. **어떤 데이터가 남아있는지** (예: "이름 필드에 '홍길동'이 남아있음")

---

## 테스트 시나리오 3: 미완료 설문 덮어쓰기 방지

### 목적

설문을 중간에 멈춘 경우, 같은 이름으로 다시 시작했을 때 덮어쓰기가 발생하는지 확인

### 테스트 단계

1. **첫 번째 설문 시작 및 중단**

   - 홈 → 설문 시작
   - 기본 스크리닝 페이지에서:
     - 이름: `김대현`
     - 생년월일: `1990-05-15`
     - 기타 필수 항목 입력
   - 제출하여 설문 페이지로 이동
   - 설문 페이지에서 일부만 입력 (완료하지 않음)
   - 브라우저를 닫거나 홈으로 이동 (설문 완료하지 않음)

2. **Firestore에서 확인** (선택사항)

   - Firebase Console → Firestore Database
   - `patients` 컬렉션에서 해당 환자 찾기
   - `lastSurveyAt` 필드가 **없는지** 확인 (미완료 설문)

3. **대시보드 확인**

   - 웹2 대시보드 접속
   - ✅ **성공**: 해당 환자가 목록에 나타나지 않음 (설문 미완료)
   - ❌ **실패**: 해당 환자가 목록에 나타남

4. **같은 이름으로 새 설문 시작**

   - 홈 → 설문 시작
   - 기본 스크리닝 페이지에서:
     - 이름: `김대현` (같은 이름)
     - 생년월일: `1990-05-15` (같은 생년월일)
     - 제출

5. **콘솔 로그 확인**
   - ✅ **성공**: `[savePatientMapped] 기존 미완료 설문 발견` 경고 로그 출력
   - ❌ **실패**: 경고 로그가 없음

### 확인해야 할 콘솔 로그

```
[savePatientMapped] 기존 미완료 설문 발견 (patientId: ...). 덮어쓰기 진행.
```

### 제공해야 할 정보

1. **콘솔 로그 전체** (특히 `[savePatientMapped]` 관련 로그)
2. **Firestore 데이터** (해당 `patientId`의 `lastSurveyAt` 필드 존재 여부)
3. **대시보드에 환자가 나타나는지 여부**

---

## 테스트 시나리오 4: 설문 완료 후 대시보드 표시 확인

### 목적

설문을 완료한 환자만 대시보드에 표시되는지 확인

### 테스트 단계

1. **설문 완료**

   - 홈 → 설문 시작
   - 기본 스크리닝 페이지 입력 및 제출
   - 설문 페이지에서 모든 질문 답변
   - 설문 결과 페이지까지 완료

2. **대시보드 확인**

   - 웹2 대시보드 접속
   - ✅ **성공**: 해당 환자가 목록에 나타남
   - ❌ **실패**: 환자가 목록에 나타나지 않음

3. **Firestore 확인** (선택사항)
   - Firebase Console → Firestore Database
   - `patients` 컬렉션에서 해당 환자 찾기
   - `lastSurveyAt` 필드가 **있는지** 확인

### 확인해야 할 콘솔 로그 (웹2)

```
[Dashboard] Firestore snapshot received: {...}
[Dashboard] Deduplication: {...}
```

### 제공해야 할 정보

1. **웹2 콘솔 로그 전체**
2. **대시보드에 환자가 나타나는지 여부**
3. **Firestore의 `lastSurveyAt` 필드 존재 여부**

---

## 문제 발생 시 제공할 정보

### 필수 정보

1. **어떤 시나리오에서 문제가 발생했는지**

   - 예: "시나리오 1의 4번 단계에서 문제 발생"

2. **콘솔 로그 전체**

   - 웹1 콘솔: `[Info]`, `[SurveyForm]`, `[savePatientMapped]` 관련 로그
   - 웹2 콘솔: `[Dashboard]` 관련 로그
   - 에러 메시지가 있다면 전체 스택 트레이스

3. **localStorage 상태** (Application 탭)

   - `survey-draft` 키의 값 (JSON 형태로 복사)
   - `patientId` 키의 값
   - `userName`, `birthDate` 등 관련 키의 값

4. **Firestore 데이터** (문제가 있는 환자의 경우)

   - `patients` 컬렉션에서 해당 환자 문서의 주요 필드:
     - `name`
     - `birthDate`
     - `lastSurveyAt` (있으면 타임스탬프, 없으면 null)
     - `createdAt`
     - `updatedAt`

5. **예상 동작 vs 실제 동작**
   - 예: "예상: 뒤로 가기 했을 때 이름이 유지되어야 함 / 실제: 이름 필드가 비어있음"

### 선택 정보 (문제 파악에 도움)

- 브라우저 종류 및 버전
- 발생 시간
- 재현 가능 여부 (같은 문제가 계속 발생하는지)

---

## 빠른 체크리스트

테스트 전에 확인:

- [ ] 브라우저 개발자 도구 열림
- [ ] 콘솔 로그 필터 설정 완료
- [ ] Application 탭에서 Local Storage 확인 가능

각 시나리오 테스트 후:

- [ ] 예상대로 동작했는지 확인
- [ ] 문제가 있으면 위의 "필수 정보" 수집
- [ ] 콘솔 로그 스크린샷 또는 복사

---

## 참고사항

- **localStorage 확인 방법**:

  1. 개발자 도구 → Application 탭
  2. 왼쪽 메뉴에서 "Local Storage" 클릭
  3. 현재 도메인 선택
  4. 키-값 쌍 확인

- **Firestore 확인 방법**:

  1. Firebase Console 접속
  2. 프로젝트 선택
  3. Firestore Database 메뉴 클릭
  4. `patients` 컬렉션 선택
  5. 문서 ID로 환자 찾기

- **콘솔 로그 복사 방법**:
  1. 콘솔에서 로그 우클릭
  2. "Save as..." 선택하여 파일로 저장
  3. 또는 로그 영역 선택 후 복사 (Cmd+C / Ctrl+C)
